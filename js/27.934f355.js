(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[27],{yqdt:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"flex flex-center"},[n("q-toolbar",{attrs:{color:"faded"}},[n("q-toolbar-title",[t._v("\n\t\t\t\tBatch List\n\t\t\t")]),n("q-btn",{attrs:{color:"primary",icon:"create",label:"New Batch"},on:{click:function(e){t.$router.push("/schedules")}}})],1),n("div",{staticClass:"q-ma-md"},[n("q-table",{attrs:{title:"Batches",data:t.sortedBatches,loading:t.tableLoading,columns:t.columns,pagination:t.pagination,filter:t.filter,separator:"cell","no-data-label":"Empty Events","row-key":"eventCode"},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"top-right",fn:function(e){return[n("q-search",{staticClass:"col-10",attrs:{color:"secondary"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})]}},{key:"body-cell-batchStart",fn:function(e){return n("q-td",{attrs:{props:e}},[t._v("\n          "+t._s(t.startBatch(e))+"\n        ")])}},{key:"body-cell-batchEnd",fn:function(e){return n("q-td",{attrs:{props:e}},[t._v("\n          "+t._s(t.endBatch(e))+"\n        ")])}},{key:"body-cell-upcomingActivity",fn:function(e){return n("q-td",{attrs:{props:e}},[t._v("\n          \n          "+t._s(t.upcomingActivity(e)?t.upcomingActivity(e).type:"Finished")+" - "+t._s(t.upcomingActivity(e)?t.$moment(t.upcomingActivity(e).startDate).format("ll"):"")+"\n        ")])}},{key:"body-cell-actions",fn:function(e){return n("q-td",{attrs:{props:e}},["standby"===e.row.status?n("q-btn",{attrs:{color:"positive",icon:"launch"},on:{click:function(n){t.launchSeason(e)}}}):t._e(),n("q-btn",{attrs:{color:"negative",icon:"delete"},on:{click:function(n){t.removeBatch(e.row)}}})],1)}}])})],1)],1)},o=[],i={mounted:function(){this.$bindAsArray("batches",this.$database.ref("event_schedules")),this.$store.commit("schedules/updateAllActivities",this.batches)},computed:{sortedBatches:function(){var t=this.$lodash.orderBy(this.batches,["eventName"],["asc"]);return console.log("sorted",t),t}},data:function(){return{batches:[],filter:"",tableLoading:!1,columns:[{name:"eventName",required:!0,label:"Event",align:"left",field:"eventName",sortable:!0},{name:"seasonName",required:!0,align:"left",label:"Season",field:"seasonName",sortable:!0,visible:!1},{name:"batchNumber",required:!0,label:"Batch",align:"left",field:"batchNumber",sortable:!0},{name:"batchStart",required:!0,label:"Start",align:"left",sortable:!0},{name:"batchEnd",required:!0,label:"End",align:"left",sortable:!0},{name:"upcomingActivity",required:!0,label:"Upcomming Activity",align:"left",sortable:!0},{name:"actions",required:!0,label:"Actions",align:"center",field:"name",sortable:!1}],pagination:{sortBy:null,descending:!1,page:1,rowsPerPage:10}}},methods:{test:function(){this.sortedBatches},startBatch:function(t){var e=t.row.activities,n=this.$lodash.map(e,function(t){return t.startDate}),a=this.$lodash.orderBy(n,["startDate"],["asc"]);return this.$moment(a[0]).format("ll")},endBatch:function(t){var e=t.row.activities,n=this.$lodash.map(e,function(t){return t.endDate}),a=this.$lodash.orderBy(n,["endDate"],["desc"]);return this.$moment(a[a.length-1]).format("ll")},upcomingActivity:function(t){var e=t.row.activities,n=new Date,a=[];console.log("act",e);for(var o=0;o<e.length;o++){var i=this.$mathMixin.dayDiff(n,new Date(e[o].startDate));console.log("el",i),i>=1&&"payment"!=e[o].type&&a.push(e[o])}return console.log("up",a[0]),a[0]},removeBatch:function(t){var e=this;this.$q.dialog({title:"Delete Confirmation",message:"Do you want to delete ".concat(t.eventName," Batch ").concat(t.batchNumber,"?"),ok:"Yes",cancel:"No"}).then(function(){console.log("data",t);var n=t[".key"];e.$firebase.database().ref("event_schedules/".concat(n)).remove().then(function(){e.$q.notify({message:"".concat(t.eventName," batch ").concat(t.batchNumber," deleted"),type:"info",color:"info",textColor:"white",icon:"info"})}).catch(function(t){e.$q.notify({message:"An Error occur",type:"info",color:"info",textColor:"white",icon:"info"}),console.log("err",t)})}).catch(function(){})}}},c=i,r=n("KHd+"),s=Object(r["a"])(c,a,o,!1,null,null,null);e["default"]=s.exports}}]);