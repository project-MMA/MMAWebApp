(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[49],{etLl:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{staticClass:"q-pa-md"},[n("q-toggle",{attrs:{label:"Advance Date to 2019-04-01"},model:{value:t.isAdvanceDate,callback:function(e){t.isAdvanceDate=e},expression:"isAdvanceDate"}}),n("div",{staticClass:"row"},[n("div",{staticClass:"col-4-md q-px-md"}),n("div",{staticClass:"col-md"},[n("q-table",{attrs:{title:t.getEventName,data:t.getSeasons,columns:t.columns,"no-data-label":"No Seasons yet","row-key":"name"},scopedSlots:t._u([{key:"top-right",fn:function(e){return[n("q-btn",{attrs:{label:"print",icon:"print"},on:{click:t.print}})]}},{key:"body-cell-contractSigned",fn:function(e){return n("q-td",{attrs:{props:e}},[t._v("\n          "+t._s(t.getContractSigned(e))+"\n        ")])}},{key:"body-cell-fullPaid",fn:function(e){return n("q-td",{attrs:{props:e}},[t._v("\n\t          "+t._s(t.getFullPaid(e))+"\n        ")])}},{key:"body-cell-installment",fn:function(e){return n("q-td",{attrs:{props:e}},[t._v("\n\t          "+t._s(t.getInstallment(e))+"\n        ")])}},{key:"body-cell-backout",fn:function(e){return n("q-td",{attrs:{props:e}},[t._v("\n\t          "+t._s(t.getBackOut(e))+"\n        ")])}},{key:"body-cell-rate",fn:function(e){return n("q-td",{attrs:{props:e}},[t._v("\n          "+t._s(t._f("currency")(e.row.totalAmount))+"\n        ")])}},{key:"body-cell-grossSales",fn:function(e){return n("q-td",{attrs:{props:e}},[t._v("\n          "+t._s(t._f("currency")(t.getGrossSales(e)))+"\n        ")])}}])})],1)])],1)},s=[],o=(n("91GP"),n("lSNA")),r=n.n(o),i=(n("rGqo"),n("yt8O"),n("dRSK"),n("a1Th"),n("pIFo"),n("RIqP")),l=n.n(i),c=n("EyHm"),u=n.n(c),d=n("5JmO"),h=n("TruH");d.vfs=h.pdfMake.vfs;var m="",g=new XMLHttpRequest;g.open("GET","assets/mma.png",!0),g.responseType="blob",g.onload=function(t){var e=new FileReader;e.onload=function(t){m=t.target.result};var n=this.response;e.readAsDataURL(n)},g.send();var f={components:{apexcharts:u.a},created:function(){if(this.$q.localStorage.has("user")){var t=this.$q.localStorage.get.item("user");this.$bindAsArray("userLoggedIn",this.$database.ref("users").orderByKey().equalTo(t)),this.eventKey=this.$route.params.eventKey}},mounted:function(){this.$bindAsArray("events",this.$database.ref("events")),this.$bindAsArray("contractSigned",this.$database.ref("contractSigned")),this.$bindAsArray("schedules",this.$database.ref("event_schedules")),this.$bindAsArray("models",this.$database.ref("models")),this.$bindAsArray("showUps",this.$database.ref("showUpModels")),this.$bindAsArray("payments",this.$database.ref("payment_transactions"))},watch:{isAdvanceDate:function(){this.isAdvanceDate?this.advanceDate="2019-04-01":this.advanceDate=""}},computed:{getTotalGrossSales:function(){var t=this,e=l()(this.getSeasons),n=this.$lodash.map(e,function(e){var n={row:e};return{grossSales:t.getGrossSales(n)}}),a=this.$lodash.sumBy(n,"grossSales");return a},mapToPrint:function(){var t=this,e=this;console.log("seasons",e.getSeasons);var n=l()(e.getSeasons),a=this.$lodash.map(n,function(e){var n={row:e};return{seasonNumber:e.seasonNumber,contactSigned:t.getContractSigned(n),fullPaid:t.getFullPaid(n),installment:t.getInstallment(n),backout:t.getBackOut(n),seasonRate:"P ".concat(e.totalAmount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),grossSales:"P ".concat(t.getGrossSales(n).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))}});return console.log("mapSeasons",a),a},getSeasons:function(){try{return this.getEvent.seasons}catch(t){return[]}},getEventName:function(){try{return this.getEvent.eventName}catch(t){return""}},getEvent:function(){var t=this;try{console.log("eventKey",this.eventKey);var e=this.$lodash.find(this.events,function(e){return e[".key"]===t.eventKey});return console.log("event",e),e}catch(t){var n={eventName:"",seasons:[]};return n}},topEventTable:function(){var t=this,e=this.$lodash.groupBy(this.contractSigned,"eventName"),n=this.$lodash.map(e,function(e,n,a){console.log("obj[key]",a[n][0].eventKey);var s={totalSales:t.getTotalSales2(a[n][0].eventKey),models:a[n].length,eventName:n};return s});return console.log("dataMap",n),this.$lodash.orderBy(n,"models","desc")},getSalesPercent:function(){var t=this;try{console.log("payments",this.payments);var e=l()(this.payments),n=this.$lodash.map(e,function(e){var n=t.$moment(new Date(e.create_time),"YYYY-MM-DD").format("MMMM");return e.dateMonthAdded=n,e}),a=this.$lodash.groupBy(n,"dateMonthAdded"),s=(this.$lodash.keys(a),this.$lodash.map(a,function(e,n,a){return t.$lodash.forEach(e,function(t){t.transaction_amount=parseFloat(t.transaction_amount)}),a[n]=t.$lodash.sumBy(e,"transaction_amount"),a[n]})),o=s.length,r=s[o-2],i=s[o-1];if("undefined"===typeof r)return 100;var c=parseFloat(r)/parseFloat(i)*100;return c.toFixed(2)}catch(t){return 0}},getSalesChartData:function(){var t=this;try{var e=l()(this.payments),n=this.$lodash.map(e,function(e){var n=t.$moment(new Date(e.create_time),"YYYY-MM-DD").format("MMMM");return e.dateMonthAdded=n,e}),a=this.$lodash.groupBy(n,"dateMonthAdded"),s=this.$lodash.keys(a),o=this.$lodash.map(a,function(e,n,a){return t.$lodash.forEach(e,function(t){t.transaction_amount=parseFloat(t.transaction_amount)}),a[n]=t.$lodash.sumBy(e,"transaction_amount"),a[n]}),r={chart:{id:"HitRateChart"},xaxis:{categories:s}},i=[{name:"HitRate",data:l()(o)}],c={chartOpt:r,series:i};return c}catch(t){return[]}},getTotalSales:function(){var t=this;try{var e=l()(this.payments),n=this.$lodash.map(e,function(e){var n=t.$moment(new Date(e.create_time),"YYYY-MM-DD").format("YYYY");return e.dateYearAdded=n,e}),a=this.$lodash.groupBy(n,"dateYearAdded"),s=this.$lodash.keys(a);console.log("years",s);var o=this.$lodash.map(a,function(e,n,a){return t.$lodash.forEach(e,function(t){t.transaction_amount=parseFloat(t.transaction_amount)}),a[n]=t.$lodash.sumBy(e,"transaction_amount"),a}),r=this.$moment(new Date,"YYYY-MM-DD").format("YYYY");return o[0][r]}catch(t){return 0}},getEventsWithSeason:function(){var t=this,e=new Array;return this.$lodash.forEach(this.events,function(n){t.$lodash.has(n,"seasons")&&e.push(n)}),e},getEventSeasons:function(){return console.log("event seasons in select",this.selectedEvent.seasons),this.selectedEvent.seasons}},data:function(){return{isAdvanceDate:!1,advanceDate:"",eventKey:"",showUps:[],selectedEvent:{},graphSeasons:[],payments:[],data:[{name:"Teen Fashion Festival",data:{Season1:10032,Season2:1001492,Season3:100150,Season4:100500}}],events:[],models:[],schedules:[],contractSigned:[],showUpModels:[],paymentTransactions:[],columns:[{name:"season",required:!0,label:"Season",align:"center",field:"seasonNumber",sortable:!0,classes:"color: primary",style:"width: 500px, color: primary"},{name:"contractSigned",required:!0,label:"Contract Signed",align:"center",sortable:!0},{name:"fullPaid",required:!0,label:"Full Paid",align:"center",sortable:!0},{name:"installment",required:!0,label:"Installment",align:"center",sortable:!0},{name:"backout",required:!0,label:"Back Out",align:"center",sortable:!0},{name:"rate",required:!0,label:"Season Rate",align:"center",field:"totalAmount",sortable:!0},{name:"grossSales",required:!0,label:"Gross Sales",align:"center",sortable:!0}],tableData:[{name:"Frozen Yogurt",calories:159,fat:6,carbs:24,protein:4,sodium:87,calcium:"14%",iron:"1%"},{name:"Frozen Yogurts",calories:159,fat:6,carbs:24,protein:4,sodium:87,calcium:"14%",iron:"1%"}]}},methods:{getTotalSales2:function(t){var e=this.$lodash.filter(this.payments,function(e){return e.eventKey===t}),n=this.$lodash.sumBy(e,"transaction_amount");return"P "+n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},getGrossSales:function(t){console.log("gross p",t);var e=t.row.seasonName,n=this.$lodash.filter(this.payments,function(t){return t.seasonName===e}),a=this.$lodash.sumBy(n,function(t){return t.transaction_amount=parseFloat(t.transaction_amount),t.transaction_amount});return a},getFullPaid:function(t){var e=this,n=t.row.seasonName,a=this.$lodash.filter(this.contractSigned,function(t){return t.seasonName===n}),s=this.$lodash.filter(a,function(t){return"full"===t.paymentTerms}),o=(parseInt(s.length),t.row.totalAmount,[]);this.$lodash.forEach(this.payments,function(t){e.$lodash.forEach(s,function(e){e[".key"]===t.modelKey&&o.push(t)})});var r=this.$lodash.sumBy(o,"transaction_amount");return"P ".concat(r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))},getInstallment:function(t){var e=this,n=t.row.seasonName,a=this.$lodash.filter(this.contractSigned,function(t){return t.seasonName===n}),s=this.$lodash.filter(a,function(t){return"installment"===t.paymentTerms}),o=[];this.$lodash.forEach(this.payments,function(t){e.$lodash.forEach(s,function(e){e[".key"]===t.modelKey&&o.push(t)})});var r=this.$lodash.sumBy(o,"transaction_amount");return"P ".concat(r.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))},loadSelectedEvent:function(){this.selectedEvent=this.$store.state.startUp.events[0],this.test()},getContractSigned:function(t){var e=t.row.seasonName,n=this.$lodash.filter(this.contractSigned,function(t){return t.seasonName===e});return n.length},clickEvent:function(t){this.selectedEvent=t,this.test(),console.log("event",this.selectedEvent)},getGrossSales2:function(t){console.log("p",t);var e=this,n=t.seasonName,a=e.$lodash.filter(e.paymentTransactions,function(t){return t.seasonName===n}),s=e.$lodash.sumBy(a,function(t){return t.transaction_amount=parseFloat(t.transaction_amount),t.transaction_amount});return console.log("filter trans",s),s},isFinishedSeason:function(t){var e=this.$mathMixin.dayDiff(new Date(this.advanceDate),new Date(t));return e<0},test:function(){var t=this,e=this.$lodash.map(this.selectedEvent.seasons,function(e){var n="Season".concat(e.seasonNumber),a=t.getGrossSales2(e);return console.log("name gross",n,a),r()({},n,a)}),n=new Array,a={name:this.selectedEvent.eventName,data:Object.assign({},e[0])};n.push(a),this.graphSeasons=n},getBackOut:function(t){var e=this,n=t.row.seasonName,a=t.row.seasonEnd;if(this.isFinishedSeason(a)){var s=[];this.$lodash.forEach(this.contractSigned,function(t){t.seasonName===n&&0!==t.balance&&s.push(t)}),console.log("backOutModels",s);var o=[];return this.$lodash.forEach(this.payments,function(t){e.$lodash.forEach(s,function(e){e[".key"]===t.modelKey&&o.push(t)})}),console.log("backOutRecord",o),s.length}return"Season Not Finish Yet"},print:function(){var t=this.$lodash.map(this.columns,function(t){return{text:t.label,style:"header"}});console.log("columns",t);for(var e=[],n=l()(this.mapToPrint),a=0;a<n.length;a++){var s=[n[a].seasonNumber,n[a].contactSigned,n[a].fullPaid,n[a].installment,n[a].backout,n[a].seasonRate,n[a].grossSales];e.push(s)}for(var o=this,r={pageMargins:[40,40,40,60],footer:function(t,e){return{table:{widths:"*",body:[[{text:"Date prepared: ".concat(o.$moment(new Date).format("lll")),margin:[40,0,0,0]},{text:"",alignment:"left",style:"normalText",aligment:"right"}],[{text:"Prepared By: ".concat(o.userLoggedIn[0].lastName,", ").concat(o.userLoggedIn[0].firstName),margin:[40,0,0,0]},{text:"",alignment:"left",style:"normalText",aligment:"right"}],[{text:"Approved By: ",margin:[40,0,0,0]},{text:"Page "+t.toString()+" of "+e,alignment:"right",style:"normalText",aligment:"right",margin:[0,0,40,0]}]]},layout:"noBorders"}},content:[{image:m,width:100,height:70,alignment:"center"},{text:"3rd Floor Forab Building Kamuning Quezon City",alignment:"center",margin:[5,5,5,5]},{text:"Sales Record: ".concat(o.getEventName),alignment:"left",margin:[5,5,5,5]},{style:"tableExample",table:{headerRows:1,body:[t]},layout:{hLineWidth:function(t,e){return 0===t||t===e.table.body.length?2:1},vLineWidth:function(t,e){return 0===t||t===e.table.widths.length?2:1},hLineColor:function(t,e){return 0===t||t===e.table.body.length?"black":"gray"},vLineColor:function(t,e){return 0===t||t===e.table.widths.length?"black":"gray"}}},{text:"Total Gross Sales: P ".concat(o.getTotalGrossSales.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),alignment:"left",margin:[1,10,1,1]}],styles:{header:{fontSize:12,bold:!0,margin:[0,0,0,10]},tableExample:{fontSize:8,margin:[30,1,30,10]}}},i=0;i<e.length;i++)r.content[3].table.body.push(e[i]);console.log("dd",r),d.createPdf(r).download("SalesReport_".concat(o.getEventName))},test2:function(){}}},p=f,v=n("KHd+"),y=Object(v["a"])(p,a,s,!1,null,null,null);e["default"]=y.exports}}]);