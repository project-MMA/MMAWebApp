(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[43],{HwAX:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",[n("div",[n("q-toolbar",{attrs:{color:"grey-5"}},[n("q-toolbar-title",[e._v("\n\t\t\t    Available Batches\n\t\t\t  ")]),n("q-toggle",{attrs:{label:"AdvanceDate(Nov 28, 2018)"},model:{value:e.advanceDateToggle,callback:function(t){e.advanceDateToggle=t},expression:"advanceDateToggle"}})],1)],1),n("div",[n("q-table",{staticClass:"q-ma-md",attrs:{data:e.getAvailableSchedules,columns:e.columns,"no-data-label":"No Available Activity","row-key":"name"},scopedSlots:e._u([{key:"body-cell-date",fn:function(t){return n("q-td",{attrs:{props:t}},[e._v("\n        "+e._s(e.getDate(t))+"\n      ")])}},{key:"body-cell-event",fn:function(t){return n("q-td",{attrs:{props:t}},[e._v("\n        "+e._s(e.getEventName(t))+"\n      ")])}},{key:"body-cell-batch",fn:function(t){return n("q-td",{attrs:{props:t}},[e._v("\n          "+e._s(t.row.batch)+"\n      ")])}},{key:"body-cell-actType",fn:function(t){return n("q-td",{attrs:{props:t}},[e._v("\n        "+e._s(t.row.id)+"\n      ")])}},{key:"body-cell-people",fn:function(t){return n("q-td",{attrs:{props:t}},[e._v("\n        "+e._s(e.getPeople(t))+"\n      ")])}},{key:"body-cell-action",fn:function(t){return n("q-td",{attrs:{props:t}},[n("q-btn",{attrs:{label:"Select",color:"positive"},on:{click:function(n){e.confirmResched(t)}}})],1)}}])})],1)])},o=[],i=n("cDf5"),c=n.n(i),s=(n("hhXQ"),n("lSNA")),r=n.n(s),l=(n("yt8O"),n("rGqo"),{created:function(){this.eventKey=this.$route.params.eventKey,this.batchKey=this.$route.params.batchKey,this.batchNumber=this.$route.params.batchNumber,this.activityID=this.$route.params.activityID,this.activityType=this.$route.params.activityType},mounted:function(){this.$bindAsArray("schedules",this.$database.ref("event_schedules")),this.$bindAsArray("attendance",this.$database.ref("attendance")),this.$bindAsArray("courseActivities",this.$database.ref("settings/courses")),this.$bindAsArray("contractSigned",this.$database.ref("contractSigned"))},watch:{advanceDateToggle:function(){console.log("advanceDate",this.advanceDateToggle),this.advanceDateToggle?this.advanceDate="2018-11-28":this.advanceDate=""}},computed:{getOldPhotolikingID:function(){var e=this,t=this.$lodash.filter(this.schedules,function(t){return t[".key"]===e.batchKey})[0],n=this.$lodash.filter(t.activities,function(e){return"photoliking"===e.type});return console.log("old",n),n[0]},parseLastActivities:function(){for(var e=new Array,t=0;t<this.courseActivities.length;t++){var n=this.courseActivities[t].activities.length;e.push(this.courseActivities[t].activities[n-1])}var a=this.$lodash.uniqBy(e,"value");return a},getAvailableSchedules:function(){var e=this;console.log("schedules",this.schedules);var t=new Array;this.$lodash.forEach(this.schedules,function(e){t.push(e.activities)}),console.log("allAct",t);for(var n=new Array,a=0;a<t.length;a++)for(var o=function(){var o=e.$mathMixin.dayDiff(new Date(e.advanceDate),new Date(t[a][i].startDate));e.$lodash.forEach(e.parseLastActivities,function(c){c.value===e.activityType?(console.log("found final event"),t[a][i].type===e.activityType&&n.push(t[a][i])):o>7&&t[a][i].type===e.activityType&&(console.log("not final event"),n.push(t[a][i]))})},i=0;i<t[a].length;i++)o();console.log("merge",n);var c=this.$lodash.orderBy(n,function(e){return new Date(e.startDate)},"asc");return this.$lodash.uniqBy(c,"id")}},data:function(){return{advanceDate:"",advanceDateToggle:!1,contractSigned:[],courseActivities:[],schedules:[],attendance:[],availableActivities:[],eventKey:"",batchKey:"",batchNumber:"",activityID:"",activityType:"",columns:[{name:"date",required:!0,label:"Date",align:"left",field:"startDate",sortable:!0},{name:"event",required:!0,label:"Event",align:"left",sortable:!0},{name:"batch",required:!0,label:"Batch",align:"left",sortable:!0},{name:"actType",required:!0,label:"Activity Type",align:"left",sortable:!0},{name:"people",required:!0,label:"No. of People",align:"center",sortable:!0},{name:"action",required:!0,label:"Action",align:"center",sortable:!0}]}},methods:{newReschedTable:function(e,t,n){var a=this,o={newActivityID:t,oldActivityID:this.activityID,models:n},i=this;console.log("reschedTable",o),this.$database.ref("rescheduled").child(this.getBatchKey(e,t)[".key"]).set(o).then(function(){var n=a.getBatchKey(e,t)[".key"],o=t,c=a.activityType;i.$q.notify({message:"Successfully Rescheduled",type:"positive",color:"positive",textColor:"white",icon:"info"}),a.$router.push("/SMSList/".concat(n,"/").concat(o,"/").concat(c))}).catch(function(e){console.log("err",e)})},addInNewAttendance:function(e,t,n,a){this.$database.ref("attendance/".concat(e,"/").concat(t,"/models")).child(a).set(n[a]).then(function(){console.log("added new model in attendance")}).catch(function(e){console.log("error in adding new attendance",e)})},removeAttendanceAbsent:function(e){console.log("remove batchkey",this.batchKey),console.log("remove activityID",this.activityID),console.log("modelkey",e),this.$database.ref("attendance/".concat(this.batchKey,"/").concat(this.activityID,"/models/")).child(e).remove().then(function(){console.log("rescheduled status done")}).catch(function(e){console.log("an error occur in removeAttendanceAbsent",e)})},confirmResched:function(e){var t=this;this.$q.dialog({title:"Confirm",message:"Do you want to Rescheduled ".concat(this.activityID," to ").concat(e.row.id," ?"),ok:"Ok",cancel:"Cancel"}).then(function(){console.log("p",e);var n=t.$lodash.filter(t.attendance,function(e){return e[".key"]===t.batchKey})[0],a=n[t.activityID].models,o=t.$lodash.keys(n[t.activityID].models);console.log("models",a),console.log("modelKeys",o);for(var i=0;i<o.length;i++){var c={batchKey:t.getBatchKey(e.row.eventKey,e.row.id)[".key"],newActivityID:e.row.id,oldActivityID:t.activityID};console.log("resched",c),t.$database.ref("contractSigned/".concat(o[i],"/rescheduledActivity")).push(c).then(function(){console.log("rescheduled",o[i])}).catch(function(e){console.log("an error found in confirm",e)}),t.removeAttendanceAbsent(o[i]),t.addInNewAttendance(c.batchKey,e.row.id,a,o[i])}t.newReschedTable(e.row.eventKey,e.row.id,a)}).catch(function(){})},getNewPhotolikingID:function(e){var t=this.$lodash.filter(this.schedules,function(t){return t[".key"]===e})[0];return this.$lodash.filter(t.activities,function(e){return"photoliking"===e.type})},getPeople:function(e){var t=this;try{var n,a=function(){var a=e.row.id;for(n=0;n<t.attendance.length;n++){var o=t.$lodash.map(t.attendance[n],function(e,t){var n,a=(n={},r()(n,".key",t),r()(n,"value",e),n);return a}),i=t.$lodash.filter(o,function(e){return e[".key"]===a})[0];if(i){var c=Object.values(i.value.models);return console.log("models",c.length),{v:c.length}}}return{v:0}}();if("object"===c()(a))return a.v}catch(e){return 0}},getEventName:function(e){var t=e.row.eventKey,n=this.$lodash.filter(this.$store.state.startUp.events,function(e){return e[".key"]===t})[0];return n.eventName},getDate:function(e){return this.$moment(e.row.startDate).format("ll")},getBatchKey:function(e,t){for(var n=this.$lodash.filter(this.schedules,function(t){return t.eventKey===e}),a=0;a<n.length;a++)for(var o=0;o<n[a].activities.length;o++)if(n[a].activities[o].id===t)return n[a]},test:function(){console.log("this.getPhotolikingID()",this.getPhotolikingID())}}}),h=l,d=n("KHd+"),u=Object(d["a"])(h,a,o,!1,null,null,null);t["default"]=u.exports},UExd:function(e,t,n){var a=n("DVgA"),o=n("aCFj"),i=n("UqcF").f;e.exports=function(e){return function(t){var n,c=o(t),s=a(c),r=s.length,l=0,h=[];while(r>l)i.call(c,n=s[l++])&&h.push(e?[n,c[n]]:c[n]);return h}}},hhXQ:function(e,t,n){var a=n("XKFU"),o=n("UExd")(!1);a(a.S,"Object",{values:function(e){return o(e)}})}}]);