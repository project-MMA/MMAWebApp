(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[41],{DgCO:function(t,e,s){},UExd:function(t,e,s){var a=s("DVgA"),r=s("aCFj"),o=s("UqcF").f;t.exports=function(t){return function(e){var s,n=r(e),l=a(n),i=l.length,c=0,u=[];while(i>c)o.call(n,s=l[c++])&&u.push(t?[s,n[s]]:n[s]);return u}}},Y2Jy:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("q-page",{staticClass:"bgImg"},[s("q-toolbar",{attrs:{color:"faded"}},[s("q-toolbar-title",[t._v("\n\t\t\t\tMessages"),s("span",{staticClass:"capitalize",attrs:{slot:"subtitle"},slot:"subtitle"},[t._v("from "+t._s(t.getModelInfo.firstName)+" "+t._s(t.getModelInfo.lastName))])]),s("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"email"},on:{click:function(e){t.right=!t.right}}},[t.GetTotalUnread?s("q-chip",{attrs:{floating:"",color:"red"}},[t._v(t._s(t.GetTotalUnread))]):t._e()],1)],1),s("div",{staticClass:"q-pa-sm",staticStyle:{width:"auto"}},[s("div",{staticClass:"container row msgs",staticStyle:{"border-radius":"20px",height:"auto"}},[s("div",{staticClass:"scrollA scroll"},[s("div",{staticClass:"q-pa-md q-ma-md"},t._l(t.getModelMessages,function(e){return s("q-chat-message",{key:e[".key"],attrs:{index:t.$moment(e.dateTime).format("lll"),label:t.$moment(e.dateTime).format("lll"),name:e.from,text:e.msg,stamp:t.$moment(e.dateTime).fromNow(),"bg-color":e.color,"text-color":e.text,sent:e.sent,avatar:e.avatar,id:e[".key"]}})}))]),s("div",{staticClass:"col-12"},[s("q-input",{staticClass:"absolute-bottom bg-white text-dark q-pa-xs q-mx-md q-mb-sm",staticStyle:{"border-radius":"15px","border-color":"black"},attrs:{type:"textarea","hide-underline":"",label:"Text",placeholder:"Message Here"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}},[s("q-btn",{staticClass:"q-ma-sm",attrs:{flat:"",icon:"send"},on:{click:t.send}})],1)],1)])])],1),s("q-layout-drawer",{attrs:{side:"right","content-class":"mat"===t.$q.theme?"bg-grey-3":null,"content-style":{fontSize:"16px"}},model:{value:t.right,callback:function(e){t.right=e},expression:"right"}},[s("q-toolbar",{},[s("q-search",{staticClass:"bg-white text-dark full-width",attrs:{"hide-underline":"",inverted:"",clearable:"",placeholder:"Search name"},model:{value:t.searchChat,callback:function(e){t.searchChat=e},expression:"searchChat"}})],1),s("q-list-header",[t._v("Models")]),t._l(t.filteredMessages,function(e){return s("q-list",{key:e[".key"],attrs:{separator:"",link:""}},[s("div",{on:{click:t.setUnreadTrue}},[s("q-item",{attrs:{to:"/chat/"+e.accountNumber}},[s("q-item-side",{attrs:{inverted:"",letter:t.returnLetter(e),color:t.returnLastColor(e)}}),s("q-item-main",{class:t.showBold(e.accountNumber),attrs:{label:t.returnFullName(e),sublabel:t.returnLastMessage(e)}},[s("span",{staticClass:"q-caption"},[t._v(t._s(t.$moment(e.lastmsgdate).fromNow())),s("br")])]),s("q-item-side",{attrs:{right:""}},[t.showCount(e.accountNumber)?s("q-chip",{staticClass:"small",attrs:{color:"red"}},[t._v(t._s(t.showCount(e.accountNumber)))]):t._e()],1)],1)],1)])})],2)],1)},r=[],o=s("MVZn"),n=s.n(o),l=(s("RW0V"),s("a1Th"),s("rGqo"),s("yt8O"),s("hhXQ"),s("91GP"),s("SRfc"),s("Oyvg"),s("FSgC"));l["a"].getScrollTarget,l["a"].setScrollPosition;var i={data:function(){return{accountNum:"",contractsigned:[],messages:[],message:"",right:!0,msgsCount:[],showChip:!0,searchChat:""}},mounted:function(){this.scrollToEnd()},updated:function(){this.scrollToEnd()},created:function(){this.$bindAsArray("contractsigned",this.$database.ref("contractSigned")),this.accountNum=this.$route.params.id,this.$bindAsArray("messages",this.$database.ref("messages/"+this.accountNum)),this.$bindAsArray("allMessage",this.$database.ref("messages")),console.log("accountNum",this.accountNum),console.log("msgsfilter",this.messages),this.setUnreadTrue()},watch:{},computed:{filteredMessages:function(){var t=this;return this.getMessagesFrom.filter(function(e){var s=new RegExp(t.searchChat,"i"),a=e.firstName+" "+e.lastName;return a.match(s)})},getModelKey:function(){var t=this.$route.params.id;return t},getMessagesFrom:function(){var t=[];try{for(var e=0;e<this.contractsigned.length;e++)for(var s=Object.assign([],this.contractsigned[e]),a=0;a<this.allMessage.length;a++){var r=Object.assign({},this.allMessage[a]);s.accountNumber===r[".key"]&&(delete r[".key"],t.push(Object.assign({},s,{msgs:Object.values(r)})))}for(var o=0;o<t.length;o++){var n=t[o].msgs.length-1,l=new Date(t[o].msgs[n].dateTime);t[o].lastmsgdate=l,t[o].lastmessage=t[o].msgs[n].msg,t[o].lastmsgcolor=t[o].msgs[n].color,t[o].lastmsgtext=t[o].msgs[n].text,t[o].lastmsgto=t[o].msgs[n].to}var i=this.$lodash.orderBy(t,["lastmsgdate"],["desc"]);return console.log("sorted",i),console.log("accts",t),i}catch(t){return null}},getModelMessages:function(){this.$bindAsArray("modelmsgs",this.$database.ref("messages/"+this.$route.params.id));var t=[];try{for(var e=0;e<this.modelmsgs.length;e++){var s=Object.assign([],this.modelmsgs[e]);"Model Coordinator"!==s.from?(delete s.sent,t.push(Object.assign({},s))):t.push(Object.assign({},s))}return console.log("filter SENT",t),t}catch(t){}},getLastMessageKey:function(){var t=this.getModelMessages.length,e=this.getModelMessages[t-1][".key"],s="#"+e.toString();return console.log(s),s},getModelInfo:function(){var t=this;try{var e=this.$lodash.filter(this.contractsigned,function(e){return e.accountNumber===t.getModelKey});return console.log("list",e),e[0]}catch(t){return{}}},MessageCounter:function(){console.log("mes",this.allMessage[0]);for(var t=[],e=0;e<this.allMessage.length;e++){for(var s=this.allMessage[e][".key"],a=Object.keys(this.allMessage[e]),r=[],o=0;o<a.length-1;o++)r.push(n()({},this.allMessage[e][a[o]]));var l=this.$lodash.filter(r,function(t){return"Model Coordinator"===t.to&&!1===t.seen});console.log("filtered",l),t.push({count:l.length,key:s})}return console.log("COUNTER",t),t},GetTotalUnread:function(){try{var t=this.$lodash.sumBy(this.MessageCounter,"count");return 0===t?0:t}catch(t){return null}}},methods:{send:function(){var t=this,e={to:this.getModelInfo.firstName,from:"Model Coordinator",msg:[this.message],dateTime:this.$moment().format("LLL"),color:"white",text:"dark",avatar:"statics/secreterial.png",sent:!0,seen:!1};console.log(e),this.$database.ref("messages/"+this.getModelKey).push(e).then(function(){t.message=""})},showCount:function(t){var e=0;try{for(var s=0;s<this.MessageCounter.length;s++){var a=this.MessageCounter[s].key;a===t&&(e=this.MessageCounter[s].count)}return 0===e?0:e}catch(t){}},showBold:function(t){var e=0;try{for(var s=0;s<this.MessageCounter.length;s++){var a=this.MessageCounter[s].key;a===t&&(e=this.MessageCounter[s].count)}return 0===e?"q-body-1":"text-weight-bolder q-body-1"}catch(t){}},setUnreadTrue:function(){for(var t=this.$route.params.id,e=0;e<this.getModelMessages.length;e++)"Model Coordinator"===this.getModelMessages[e].to&&!1===this.getModelMessages[e].seen&&this.$database.ref("messages/"+t+"/"+this.getModelMessages[e][".key"]+"/seen").set(!0)},getMsgs:function(t){var e=t[".key"];this.$bindAsArray("modelmsgsdate",this.$database.ref("messages/"+e));try{var s=this.modelmsgsdate;return console.log("S",s),lastf}catch(t){}},returnFullName:function(t){try{var e=this.$lodash.capitalize(t.firstName)+" "+this.$lodash.capitalize(t.lastName);return e}catch(t){return""}},returnLastMessage:function(t){try{var e=t.lastmessage.toString();if("Model Coordinator"===t.lastmsgto)return e.length>45?e.slice(0,45)+" [. . .]":e;var s="You: "+e;return e.length>45?s.slice(0,45)+" [. . .]":s}catch(t){return""}},returnLastColor:function(t){try{t.lastmsgtext;var e=t.lastmsgcolor;return"Model Coordinator"!==t.lastmsgto?"light":e}catch(t){return""}},returnLetter:function(t){try{var e=t.firstName,s=this.$lodash.filter(e,function(t){return t});return s[0].toUpperCase()}catch(t){return""}},scrollToEnd:function(){var t=document.querySelector(".scrollA"),e=t.scrollHeight;t.scrollTop=e,this.setUnreadTrue()}}},c=i,u=(s("wAlm"),s("KHd+")),g=Object(u["a"])(c,a,r,!1,null,null,null);e["default"]=g.exports},hhXQ:function(t,e,s){var a=s("XKFU"),r=s("UExd")(!1);a(a.S,"Object",{values:function(t){return r(t)}})},wAlm:function(t,e,s){"use strict";var a=s("DgCO"),r=s.n(a);r.a}}]);