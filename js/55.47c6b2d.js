(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[55],{H2kS:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("q-tabs",{staticClass:"row",attrs:{color:"tertiary",animated:"",align:"justify"},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[a("q-tab",{attrs:{slot:"title",default:"",name:"allEvents",label:"All Events"},slot:"title"}),e._l(e.events,function(e){return a("div",{key:e[".key"],attrs:{slot:"title"},slot:"title"},[a("q-tab",{attrs:{name:e[".key"],label:e.eventName}})],1)}),a("q-tab-pane",{attrs:{name:"allEvents"}},[a("all-events")],1),a("q-tab-pane",{attrs:{name:e.selectedTab}},["allEvents"!==e.selectedTab?a("by-events",{attrs:{eventKey:e.selectedTab,eventName:e.getEventName}}):e._e()],1)],2)],1)},s=[],l=(a("dRSK"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("q-toggle",{attrs:{label:"Advance Date to 2019-02-01"},model:{value:e.isAdvanceDate,callback:function(t){e.isAdvanceDate=t},expression:"isAdvanceDate"}}),a("q-table",{ref:"table",attrs:{data:e.mappedModels,columns:e.columns,filter:e.filter,"row-key":"name",pagination:e.pagination,loading:e.loading},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"top-left",fn:function(t){return[a("span",{staticClass:"q-title"},[e._v("All Events")])]}},{key:"top-right",fn:function(t){return[a("div",{staticClass:"q-px-md"},[a("p",[e._v("Back Out Models: "+e._s(e.mappedModels.length))]),a("p",[e._v("Total Payments: P "+e._s(e.getTotalPayments))])]),a("q-search",{attrs:{"hide-underline":""},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),a("q-btn",{attrs:{label:"print",icon:"print"},on:{click:function(t){e.print()}}})]}}])})],1)}),o=[],i=(a("rGqo"),a("a1Th"),a("pIFo"),a("RIqP")),r=a.n(i),d=a("5JmO"),c=a("TruH");d.vfs=c.pdfMake.vfs;var u="",m=new XMLHttpRequest;m.open("GET","assets/mma.png",!0),m.responseType="blob",m.onload=function(e){var t=new FileReader;t.onload=function(e){u=e.target.result};var a=this.response;t.readAsDataURL(a)},m.send();var h={created:function(){if(this.$q.localStorage.has("user")){var e=this.$q.localStorage.get.item("user");this.$bindAsArray("userLoggedIn",this.$database.ref("users").orderByKey().equalTo(e)),console.log("user2",e)}},mounted:function(){this.$bindAsArray("contractSigned",this.$database.ref("contractSigned")),this.$bindAsArray("schedules",this.$database.ref("event_schedules")),this.$bindAsArray("events",this.$database.ref("events")),this.$bindAsArray("paymentRecords",this.$database.ref("payment_transactions"))},watch:{isAdvanceDate:function(){this.isAdvanceDate?this.advanceDate="2019-02-01":this.advanceDate=""}},computed:{mappedModels:function(){var e=this,t=this.$lodash.map(this.backOutModels,function(t){return t.fullName="".concat(t.lastName,", ").concat(t.firstName),t.seasonAndBatch=e.getSeasonAndBatch(t.seasonName,t.batchKey),t.seasonRate=e.getSeasonRate(t.batchKey),t.lastPaidDate=e.getLastPaidDate(t[".key"]),t.totalPaid=e.getTotalPaid(t[".key"]),t.paymentTerms=e.$lodash.capitalize(t.paymentTerms),t});return console.log("mapmodels",t),t},getFullPaidModels:function(){var e=this.$lodash.filter(this.mappedModels,function(e){return"Full"===e.paymentTerms});return e},getInstallmentModels:function(){var e=this.$lodash.filter(this.mappedModels,function(e){return"Installment"===e.paymentTerms});return e},getNotPaidModels:function(){var e=r()(this.mappedModels),t=this.$lodash.map(e,function(e){return e.paymentTerms2=e.paymentTerms?e.paymentTerms:"Not Paid",e}),a=this.$lodash.filter(t,function(e){return"Not Paid"===e.paymentTerms2});return console.log("getNotPaidModels",a),a},getTotalPayments:function(){var e=r()(this.mappedModels),t=this.$lodash.sumBy(e,function(e){return parseFloat(e.totalPaid.replace(/,/g,""))});return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},finishedSeasons:function(){var e=this,t=[];this.$lodash.forEach(this.events,function(a){e.$lodash.forEach(a.seasons,function(e){t.push(e)})});var a=this.$lodash.filter(t,function(t){var a=e.$mathMixin.dayDiff(new Date(e.advanceDate),new Date(t.seasonEnd));if(a<0)return t});return a},backOutModels:function(){var e=this,t=[];return this.$lodash.forEach(this.contractSigned,function(a){e.$lodash.forEach(e.finishedSeasons,function(e){a.seasonName===e.seasonName&&0!==a.balance&&t.push(a)})}),t}},data:function(){return{isAdvanceDate:!1,advanceDate:"",userLoggedIn:[],paymentRecords:[],schedules:[],contractSigned:[],selectOptions:[],loading:!1,filter:"",serverData:[],columns:[{name:"fullName",align:"left",label:"Full Name",field:"fullName",sortable:!0},{name:"event",align:"left",label:"Event Name",field:"eventName",sortable:!0},{name:"seasonBatch",align:"left",label:"Season & Batch",field:"seasonAndBatch"},{name:"seasonRate",align:"left",label:"Season Rate",field:"seasonRate"},{name:"paymentTerm",align:"left",label:"Payment Term",field:"paymentTerms",sortable:!0},{name:"lastPaidDate",align:"left",label:"Last Paid Date",sortable:!0,field:"lastPaidDate"},{name:"balance",align:"left",label:"Remaining Balance",sortable:!0,field:"balance"},{name:"totalPaid",align:"left",label:"Total Paid",field:"totalPaid",sortable:!0}],pagination:{sortBy:null,descending:!1,page:1,rowsPerPage:0}}},methods:{getSeasonAndBatch:function(e,t){var a=this.$lodash.find(this.schedules,function(e){return e[".key"]===t});return"".concat(e,"_Batch(").concat(a.batchNumber,")")},getSeasonRate:function(e){var t=this.$lodash.find(this.schedules,function(t){return t[".key"]===e});return t.totalAmount},getLastPaidDate:function(e){try{var t=this.$lodash.filter(this.paymentRecords,function(t){return t.modelKey===e}),a=this.$lodash.orderBy(t,function(e){return new Date(e.create_time)},"desc");return a[0].create_time?this.$moment(a[0].create_time).format("ll"):"Not Paid"}catch(e){return"Not Paid"}},getTotalPaid:function(e){var t=this.$lodash.filter(this.paymentRecords,function(t){return t.modelKey===e}),a=this.$lodash.sumBy(t,function(e){return parseFloat(e.transaction_amount)}),n=parseInt(a)||0;return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},print:function(){var e=this.$lodash.map(this.columns,function(e){return{text:e.label}});console.log("columns",e);for(var t=[],a=r()(this.mappedModels),n=0;n<a.length;n++){var s=a[n].paymentTerms?a[n].paymentTerms:"Not Paid",l=[a[n].fullName,a[n].eventName,a[n].seasonAndBatch,a[n].seasonRate,s,a[n].lastPaidDate,a[n].balance,a[n].totalPaid];t.push(l)}var o=this;console.log("mappedModels",this.mappedModels.length.toString());for(var i={pageMargins:[40,40,40,60],footer:function(e,t){return{table:{widths:"*",body:[[{text:"Date prepared: ".concat(o.$moment(new Date).format("lll")),margin:[40,0,0,0]},{text:"",alignment:"left",style:"normalText",aligment:"right"}],[{text:"Prepared By: ".concat(o.userLoggedIn[0].lastName,", ").concat(o.userLoggedIn[0].firstName),margin:[40,0,0,0]},{text:"",alignment:"left",style:"normalText",aligment:"right"}],[{text:"Approved By: ",margin:[40,0,0,0]},{text:"Page "+e.toString()+" of "+t,alignment:"right",style:"normalText",aligment:"right",margin:[0,0,40,0]}]]},layout:"noBorders"}},content:[{image:u,width:100,height:70,alignment:"center"},{text:"3rd Floor Forab Building Kamuning Quezon City",alignment:"center",margin:[5,5,5,5]},{text:"Payment Records: Back Out - All Events",alignment:"left",margin:[5,5,5,5]},{style:"tableExample",table:{headerRows:1,body:[e]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,t){return 0===e||e===t.table.body.length?"black":"gray"},vLineColor:function(e,t){return 0===e||e===t.table.widths.length?"black":"gray"}}},{text:"Back Out: ".concat(this.mappedModels.length),alignment:"left",margin:[1,1,1,1]},{text:"Total Payments: P ".concat(this.getTotalPayments),alignment:"left",margin:[1,1,1,1]}],styles:{header:{fontSize:18,bold:!0,margin:[0,0,0,10]},tableExample:{fontSize:8,margin:[30,1,30,10]}}},c=0;c<t.length;c++)i.content[3].table.body.push(t[c]);console.log("dd",i),d.createPdf(i).download("PaymentReports_Backout_AllEvents")},test:function(){console.log("backOutModels",this.backOutModels)}}},f=h,g=a("KHd+"),p=Object(g["a"])(f,l,o,!1,null,null,null),b=p.exports,v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("q-toggle",{attrs:{label:"Advance Date to 2019-02-01"},model:{value:e.isAdvanceDate,callback:function(t){e.isAdvanceDate=t},expression:"isAdvanceDate"}}),a("q-table",{ref:"table",attrs:{data:e.mappedModels,columns:e.columns,filter:e.filter,"row-key":"name","no-data-label":"No Backout Yet",pagination:e.pagination,loading:e.loading},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"top-left",fn:function(t){return[a("p",{staticClass:"q-title"},[e._v(e._s(e.eventName)+" - ")]),a("br"),a("p",[a("q-select",{attrs:{options:e.seasonOpt},model:{value:e.selectedSeason,callback:function(t){e.selectedSeason=t},expression:"selectedSeason"}})],1)]}},{key:"top-right",fn:function(t){return[a("div",{staticClass:"q-px-md"},[a("p",[e._v("Backout Models: "+e._s(e.mappedModels.length))]),a("p",[e._v("Total Payments: P "+e._s(e.getTotalPayments))])]),a("q-search",{attrs:{"hide-underline":""},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),a("q-btn",{attrs:{label:"print",icon:"print"},on:{click:function(t){e.print()}}})]}}])})],1)},y=[],$=a("5JmO"),P=a("TruH");$.vfs=P.pdfMake.vfs;var T="",N=new XMLHttpRequest;N.open("GET","assets/mma.png",!0),N.responseType="blob",N.onload=function(e){var t=new FileReader;t.onload=function(e){T=e.target.result};var a=this.response;t.readAsDataURL(a)},N.send();var A={created:function(){if(this.$q.localStorage.has("user")){var e=this.$q.localStorage.get.item("user");this.$bindAsArray("userLoggedIn",this.$database.ref("users").orderByKey().equalTo(e))}},mounted:function(){this.$bindAsArray("contractSigned",this.$database.ref("contractSigned")),this.$bindAsArray("schedules",this.$database.ref("event_schedules")),this.$bindAsArray("paymentRecords",this.$database.ref("payment_transactions")),this.$bindAsArray("events",this.$database.ref("events"))},props:{eventKey:String,eventName:String},watch:{seasonOpt:{handler:function(){this.loadSelectSeason()},deep:!0},isAdvanceDate:function(){this.isAdvanceDate?this.advanceDate="2019-02-01":this.advanceDate=""}},computed:{mappedModels:function(){var e=this,t=this.$lodash.filter(this.backOutModels,function(t){return t.eventKey===e.eventKey&&t.seasonName===e.selectedSeason}),a=this.$lodash.map(t,function(t){return t.fullName="".concat(t.lastName,", ").concat(t.firstName),t.seasonAndBatch=e.getSeasonAndBatch(t.seasonName,t.batchKey),t.seasonRate=e.getSeasonRate(t.batchKey),t.lastPaidDate=e.getLastPaidDate(t[".key"]),t.totalPaid=e.getTotalPaid(t[".key"]),t.paymentTerms=e.$lodash.capitalize(t.paymentTerms),t});return console.log("mapmodels",a),this.$lodash.orderBy(a,"fullName","asc")},getFullPaidModels:function(){var e=this.$lodash.filter(this.mappedModels,function(e){return"Full"===e.paymentTerms});return e},getInstallmentModels:function(){var e=this.$lodash.filter(this.mappedModels,function(e){return"Installment"===e.paymentTerms});return e},getNotPaidModels:function(){var e=r()(this.mappedModels),t=this.$lodash.map(e,function(e){return e.paymentTerms2=e.paymentTerms?e.paymentTerms:"Not Paid",e}),a=this.$lodash.filter(t,function(e){return"Not Paid"===e.paymentTerms2});return a},getTotalPayments:function(){var e=r()(this.mappedModels),t=this.$lodash.sumBy(e,function(e){return parseFloat(e.totalPaid.replace(/,/g,""))});return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},finishedSeasons:function(){var e=this,t=[];this.$lodash.forEach(this.events,function(a){e.$lodash.forEach(a.seasons,function(e){t.push(e)})});var a=this.$lodash.filter(t,function(t){var a=e.$mathMixin.dayDiff(new Date(e.advanceDate),new Date(t.seasonEnd));if(a<0)return t});return a},backOutModels:function(){var e=this,t=[];return this.$lodash.forEach(this.contractSigned,function(a){e.$lodash.forEach(e.finishedSeasons,function(e){a.seasonName===e.seasonName&&0!==a.balance&&t.push(a)})}),t},getEvent:function(){var e=this,t=this.$lodash.find(this.events,function(t){return t[".key"]===e.eventKey});return t},seasonOpt:function(){try{var e=this.getEvent.seasons,t=this.$lodash.map(e,function(e){return{label:"Season ".concat(e.seasonNumber),value:e.seasonName}});return this.$lodash.orderBy(t,"label","desc")}catch(e){return[]}}},data:function(){return{selectedSeason:"",isAdvanceDate:!1,advanceDate:"",events:[],userLoggedIn:[],paymentRecords:[],schedules:[],contractSigned:[],selectOptions:[],loading:!1,filter:"",serverData:[],columns:[{name:"fullName",align:"left",label:"Full Name",field:"fullName",sortable:!0},{name:"event",align:"left",label:"Event Name",field:"eventName",sortable:!0},{name:"seasonBatch",align:"left",label:"Season & Batch",field:"seasonAndBatch"},{name:"seasonRate",align:"left",label:"Season Rate",field:"seasonRate"},{name:"paymentTerm",align:"left",label:"Payment Term",field:"paymentTerms",sortable:!0},{name:"lastPaidDate",align:"left",label:"Last Paid Date",sortable:!0,field:"lastPaidDate"},{name:"balance",align:"left",label:"Remaining Balance",sortable:!0,field:"balance"},{name:"totalPaid",align:"left",label:"Total Paid",field:"totalPaid",sortable:!0}],pagination:{sortBy:null,descending:!1,page:1,rowsPerPage:0}}},methods:{loadSelectSeason:function(){try{this.selectedSeason=this.seasonOpt[0].value}catch(e){return 0}},getSeasonAndBatch:function(e,t){var a=this.$lodash.find(this.schedules,function(e){return e[".key"]===t});return"".concat(e,"_Batch(").concat(a.batchNumber,")")},getSeasonRate:function(e){var t=this.$lodash.find(this.schedules,function(t){return t[".key"]===e});return t.totalAmount},getLastPaidDate:function(e){try{var t=this.$lodash.filter(this.paymentRecords,function(t){return t.modelKey===e}),a=this.$lodash.orderBy(t,function(e){return new Date(e.create_time)},"desc");return a[0].create_time?this.$moment(a[0].create_time).format("ll"):"Not Paid"}catch(e){return"Not Paid"}},getTotalPaid:function(e){var t=this.$lodash.filter(this.paymentRecords,function(t){return t.modelKey===e}),a=this.$lodash.sumBy(t,function(e){return parseFloat(e.transaction_amount)}),n=parseInt(a)||0;return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},print:function(){var e=this.$lodash.map(this.columns,function(e){return{text:e.label}}),t=this.eventName;console.log("columns",e);for(var a=[],n=r()(this.mappedModels),s=0;s<n.length;s++){var l=n[s].paymentTerms?n[s].paymentTerms:"Not Paid",o=[n[s].fullName,n[s].eventName,n[s].seasonAndBatch,n[s].seasonRate,l,n[s].lastPaidDate,n[s].balance,n[s].totalPaid];a.push(o)}var i=this;console.log("mappedModels",this.mappedModels.length.toString());for(var d={pageMargins:[40,40,40,60],footer:function(e,t){return{table:{widths:"*",body:[[{text:"Date prepared: ".concat(i.$moment(new Date).format("lll")),margin:[40,0,0,0]},{text:"",alignment:"left",style:"normalText",aligment:"right"}],[{text:"Prepared By: ".concat(i.userLoggedIn[0].lastName,", ").concat(i.userLoggedIn[0].firstName),margin:[40,0,0,0]},{text:"",alignment:"left",style:"normalText",aligment:"right"}],[{text:"Approved By: ",margin:[40,0,0,0]},{text:"Page "+e.toString()+" of "+t,alignment:"right",style:"normalText",aligment:"right",margin:[0,0,40,0]}]]},layout:"noBorders"}},content:[{image:T,width:100,height:70,alignment:"center"},{text:"3rd Floor Forab Building Kamuning Quezon City",alignment:"center",margin:[5,5,5,5]},{text:"Payment Records: Backout - ".concat(t),alignment:"left",margin:[5,5,5,5]},{style:"tableExample",table:{headerRows:1,body:[e]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,t){return 0===e||e===t.table.body.length?"black":"gray"},vLineColor:function(e,t){return 0===e||e===t.table.widths.length?"black":"gray"}}},{text:"Backout Models: ".concat(this.mappedModels.length),alignment:"left",margin:[1,1,1,1]},{text:"Total Payments: P ".concat(this.getTotalPayments),alignment:"left",margin:[1,1,1,1]}],styles:{header:{fontSize:18,bold:!0,margin:[0,0,0,10]},tableExample:{fontSize:8,margin:[30,1,30,10]}}},c=0;c<a.length;c++)d.content[3].table.body.push(a[c]);console.log("dd",d),$.createPdf(d).download("PaymentReports_Backout_".concat(t))},test:function(){console.log("startp\t",this.eventName)}}},S=A,B=Object(g["a"])(S,v,y,!1,null,null,null),D=B.exports,k={components:{AllEvents:b,ByEvents:D},watch:{selectedTab:function(){}},mounted:function(){this.$bindAsArray("events",this.$database.ref("events"))},computed:{getEventName:function(){var e=this;try{var t=this.$lodash.find(this.events,function(t){return t[".key"]===e.selectedTab});return t.eventName}catch(e){return""}}},data:function(){return{selectedTab:"",events:[]}}},M=k,x=Object(g["a"])(M,n,s,!1,null,null,null);t["default"]=x.exports}}]);